# Disable default directory file listings
Options -Indexes

# Disable default automatic Expires headers
<ifmodule mod_expires.c>
ExpiresActive Off
</ifmodule>

<Files "index.html">
# Preload assets for app shell/core functionality
# Note: only works when deployed on server at root level
Header add Link "</css/calc.css>; rel=preload; as=style"
Header add Link "</js/calc.js>; rel=preload; as=script"
# Game selector
Header add Link "</js/games.js>; rel=preload; as=script"
Header add Link "</css/games.css>; rel=preload; as=style"
Header add Link "</games.json>; rel=preload; as=fetch; crossorigin"
Header add Link "</img/fa-gamepad.svg>; rel=preload; as=fetch; crossorigin"
Header add Link "</img/md-check_box.svg>; rel=preload; as=fetch; crossorigin"
Header add Link "</img/md-radio_button.svg>; rel=preload; as=fetch; crossorigin"
# Target BPM
Header add Link "</js/targetbpm.js>; rel=preload; as=script"
Header add Link "</css/targetbpm.css>; rel=preload; as=style"
Header add Link "</img/md-music_note.svg>; rel=preload; as=fetch; crossorigin"
Header add Link "</img/np-target.svg>; rel=preload; as=fetch; crossorigin"
# Intentionally non-preloaded functionality
# Menu / About dialog
# Dark mode toggle
# Update checker
</Files>

<FilesMatch "\.html$">
# Security headers as recommended by securityheaders.com
Header always set Content-Security-Policy "\
default-src 'none'; \
connect-src 'self'; \
img-src 'self'; \
manifest-src 'self'; \
script-src 'self' 'sha256-ZfGbruOMiTVDQsMYNRKH+oHAqKWeKFRAVrMHuztGnQo='; \
style-src 'self' 'sha256-nMc1pJn0ceZrXu1/AseDqpkZXDXIFbK3DPdspz3f+6c='; \
"

Header always set X-Frame-Options "SAMEORIGIN"
Header always set X-XSS-Protection "1; mode=block"
Header always set Referrer-Policy "strict-origin"

Header always set Feature-Policy "\
geolocation 'none'; \
microphone 'none'; \
camera 'none'; \
autoplay 'none'; \
payment 'none'; \
"
</FilesMatch>

Header set Cache-Control "public, max-age=600, s-maxage=86400"
Header always set X-Content-Type-Options "nosniff"
Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains"